{
    "apiVersion": "2018-11-01",
    "name": "[parameters('servicePlanInstanceName')]",
    "type": "Microsoft.Web/serverfarms",
    "location": "[resourceGroup().location]",
    "kind": "linux",
    "tags": "[parameters('tags')]",
    "properties": {
        "name": "[parameters('servicePlanInstanceName')]",
        "workerSize": 0,
        "workerSizeId": 0,
        "numberOfWorkers": 1,
        "hostingEnvironment": "",
        "reserved": true
    },
    "sku": {
        "tier": "Standard",
        "name": "S1"
    }
}
{
  "type": "Microsoft.Web/sites",
  "apiVersion": "2018-11-01",
  "name": "[parameters('name')]",
  "location": "[parameters('location')]",
  "dependsOn": [
    "microsoft.insights/components/mycoolfunction",
    "[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",
    "[concat('Microsoft.Storage/storageAccounts/', parameters('storageAccountName'))]"
  ],
  "tags": {},
  "kind": "functionapp,linux",
  "properties": {
    "name": "[parameters('name')]",
    "siteConfig": {
      "appSettings": [
        {
          "name": "FUNCTIONS_WORKER_RUNTIME",
          "value": "python"
        },
        {
          "name": "FUNCTIONS_EXTENSION_VERSION",
          "value": "~2"
        },
        {
          "name": "APPINSIGHTS_INSTRUMENTATIONKEY",
          "value": "[reference('microsoft.insights/components/mycoolfunction', '2015-05-01').InstrumentationKey]"
        },
        {
          "name": "AzureWebJobsStorage",
          "value": "[concat('DefaultEndpointsProtocol=https;AccountName=',parameters('storageAccountName'),';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2019-06-01').keys[0].value,';EndpointSuffix=','core.windows.net')]"
        }
      ]
    },
    "serverFarmId": "[concat('/subscriptions/', parameters('subscriptionId'),'/resourcegroups/', parameters('serverFarmResourceGroup'), '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",
    "hostingEnvironment": "[parameters('hostingEnvironment')]",
    "clientAffinityEnabled": false
  }
}
